<nav class="site-nav">
  <div class="container">
    <div class="brand"><a href="{{ site.baseurl }}/">{{ site.title }}</a></div>
    <button class="menu-toggle" aria-expanded="false" aria-controls="site-nav-list">â˜°</button>
    <ul id="site-nav-list">
      {% for item in site.data.navigation %}
      <li><a class="{% if page.url == item.url %}active{% endif %}" href="{{ site.baseurl }}{{ item.url }}">{{ item.title }}</a></li>
      {% endfor %}
    </ul>
  </div>
</nav>
<script>
  (function(){
// Get elements
var toggle = document.getElementById('menu-toggle');
var list = document.getElementById('site-nav-list');

if (!toggle || !list) return;

// Initialize based on screen size
function updateMenuState() {
  if (window.innerWidth > 768) {
    list.style.display = 'flex';
    toggle.setAttribute('aria-expanded', 'true');
  } else {
    list.style.display = 'none';
    toggle.setAttribute('aria-expanded', 'false');
  }
}

// Initial state
updateMenuState();

// Toggle menu on button click
toggle.addEventListener('click', function(e) {
  e.preventDefault();
  var isExpanded = toggle.getAttribute('aria-expanded') === 'true';

  if (isExpanded) {
    list.style.display = 'none';
    toggle.setAttribute('aria-expanded', 'false');
  } else {
    list.style.display = 'flex';
    toggle.setAttribute('aria-expanded', 'true');
  }
});

// Close menu when link is clicked
var links = list.querySelectorAll('a');
links.forEach(function(link) {
  link.addEventListener('click', function() {
    if (window.innerWidth <= 768) {
      list.style.display = 'none';
      toggle.setAttribute('aria-expanded', 'false');
    }
  });
});

// Update on window resize
window.addEventListener('resize', function() {
  if (window.innerWidth > 768) {
    list.style.display = 'flex';
    toggle.setAttribute('aria-expanded', 'true');
  } else {
    if (window.innerWidth <= 768) {
      list.style.display = 'none';
      toggle.setAttribute('aria-expanded', 'false');
    }
  }
});

// Scroll spy: highlight nav link based on current section
function updateActiveLink() {
  var sections = document.querySelectorAll('section[id]');
  var navLinks = list.querySelectorAll('a[href*="#"]');
  
  var currentSection = null;
  sections.forEach(function(section) {
    var rect = section.getBoundingClientRect();
    if (rect.top <= window.innerHeight / 2 && rect.bottom >= window.innerHeight / 2) {
      currentSection = section.id;
    }
  });
  
  navLinks.forEach(function(link) {
    link.classList.remove('active');
    if (currentSection && link.href.includes('#' + currentSection)) {
      link.classList.add('active');
    }
  });
}

window.addEventListener('scroll', updateActiveLink);
updateActiveLink(); // Initial call